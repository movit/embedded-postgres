# Обзор приложения embedded-postgres

## Что это за приложение

**embedded-postgres** — это Go библиотека, которая позволяет запускать настоящую базу данных PostgreSQL локально на Linux, macOS или Windows как часть другого Go приложения или теста.

## Основное назначение

Библиотека предназначена для:
- **Тестирования**: Обеспечивает более высокий уровень уверенности по сравнению с in-memory альтернативами
- **Разработки**: Позволяет легко интегрировать PostgreSQL в Go приложения без внешних зависимостей
- **CI/CD**: Не требует установки PostgreSQL на сервере сборки

## Ключевые особенности

### 1. Автономность
- Не требует внешних зависимостей, кроме Go экосистемы
- Автоматически загружает и устанавливает бинарные файлы PostgreSQL
- Работает на всех основных операционных системах

### 2. Простота использования
Минимальная конфигурация с разумными значениями по умолчанию:

```go
postgres := embeddedpostgres.NewDatabase()
err := postgres.Start()
// ... логика приложения ...
err := postgres.Stop()
```

### 3. Гибкая конфигурация
| Параметр | Значение по умолчанию |
|----------|----------------------|
| Username | postgres |
| Password | postgres |
| Database | postgres |
| Version | 12.1.0 |
| Port | 5432 |
| StartTimeout | 15 секунд |

## Архитектура

### Основные компоненты:

1. **EmbeddedPostgres** - главная структура, управляющая жизненным циклом PostgreSQL процесса
2. **Config** - конфигурация базы данных
3. **CacheLocator** - управление кэшированием бинарных файлов
4. **RemoteFetchStrategy** - стратегия загрузки бинарных файлов
5. **Logging** - система логирования

### Процесс работы:

1. **Инициализация**: Создание экземпляра с конфигурацией
2. **Загрузка**: Автоматическая загрузка бинарных файлов PostgreSQL из Maven репозитория
3. **Извлечение**: Распаковка в локальную директорию
4. **Запуск**: Инициализация и запуск PostgreSQL процесса
5. **Использование**: Подключение через стандартные PostgreSQL драйверы
6. **Остановка**: Корректное завершение процесса

## Использование

### Базовое использование:
```go
postgres := embeddedpostgres.NewDatabase()
err := postgres.Start()
defer postgres.Stop()
```

### Расширенная конфигурация:
```go
postgres := NewDatabase(DefaultConfig().
    Username("myuser").
    Password("mypass").
    Database("mydb").
    Version(V13).
    Port(9876).
    StartTimeout(45 * time.Second))
```

## Технические детails

- **Язык**: Go 1.18+
- **Зависимости**: 
  - github.com/lib/pq (PostgreSQL драйвер)
  - github.com/xi2/xz (декомпрессия)
  - Тестовые зависимости (testify, goleak)
- **Источник бинарных файлов**: Maven репозиторий (zonkyio/embedded-postgres-binaries)
- **Поддерживаемые версии PostgreSQL**: Множественные версии через конфигурацию

## Вдохновение

Проект вдохновлен Java библиотеками:
- zonkyio/embedded-postgres
- opentable/otj-pg-embedded

И использует предкомпилированные бинарные файлы от zonkyio/embedded-postgres-binaries.

## Применение

Идеально подходит для:
- **Unit и интеграционных тестов** Go приложений
- **Локальной разработки** без установки PostgreSQL
- **CI/CD пайплайнов** где нужна изолированная база данных
- **Микросервисов** требующих встроенную базу данных
- **Демонстрационных приложений** и прототипов

## Преимущества

1. **Реальная база данных** вместо моков или in-memory решений
2. **Нулевая конфигурация** для быстрого старта
3. **Кроссплатформенность** (Linux, macOS, Windows)
4. **Автоматическое управление** жизненным циклом
5. **Изоляция** - каждый экземпляр независим
6. **Производительность** - использует настоящий PostgreSQL

Это профессиональная библиотека для разработчиков Go, которым нужна надежная и простая в использовании встроенная PostgreSQL база данных.